以下是针对Vaultwarden部署后的**全面功能测试用例**，涵盖核心功能验证、数据安全性及边缘场景测试，并提供符合安全规范的测试数据。所有测试步骤基于部署完成后的初始状态，适合运维人员验证部署有效性。

### 一、测试准备与基础信息

#### 前置条件

- 部署完成的Vaultwarden访问地址：`https://[服务器IP]:8443`（替换为实际地址）
- 管理员令牌：部署时生成的`ADMIN_TOKEN`（从`~/vaultwarden/.env`文件中获取）
- 测试用浏览器：建议Chrome/Firefox（需接受自签名证书）

#### 测试账号与密码数据

| 类型    | 测试账号                   | 测试密码（符合安全规范）             | 备注                  |
| ----- | ---------------------- | ------------------------ | ------------------- |
| 主用户   | test_user@example.com  | `VwTest@2024!`           | 用于注册普通用户            |
| 共享用户  | share_user@example.com | `Share@123$`             | 用于组织共享测试            |
| 网站账号  | -                      | `Bank#2024$afePwd`       | 模拟银行账户              |
| 应用账号  | -                      | `App%Token789*`          | 模拟API密钥             |
| 信用卡信息 | -                      | 卡号：`4111 1111 1111 1111` | 有效期：2028-12，CVV：123 |

### 二、核心功能测试用例

#### 1. 基础访问与登录测试

| 测试目标      | 测试步骤                                         | 预期结果                         |
| --------- | -------------------------------------------- | ---------------------------- |
| 登录页面可用性   | 1. 访问`https://[IP]:8443`<br>2. 确认页面加载正常      | 显示登录界面，包含“创建账户”“忘记密码”按钮      |
| 管理员页面访问   | 1. 访问`https://[IP]:8443/admin`<br>2. 输入管理员令牌 | 成功进入管理员控制台，显示“用户管理”“组织管理”等菜单 |
| 自签名证书提示处理 | 1. 首次访问时接受浏览器的证书警告                           | 可正常进入系统，无持续警告（后续访问无需重复处理）    |

#### 2. 用户管理测试

| 测试目标    | 测试步骤                                                                            | 预期结果                        |
| ------- | ------------------------------------------------------------------------------- | --------------------------- |
| 普通用户注册  | 1. 登录页面点击“创建账户”<br>2. 输入测试账号`test_user@example.com`和密码`VwTest@2024!`<br>3. 完成注册 | 注册成功，自动跳转至密码库主页，显示“欢迎使用”引导  |
| 用户登录验证  | 1. 使用注册的账号密码登录<br>2. 尝试输入错误密码                                                   | 正确密码登录成功；错误密码提示“无效的电子邮件或密码” |
| 管理员禁用用户 | 1. 管理员页面进入“用户管理”<br>2. 找到`test_user`并点击“禁用”                                     | 用户状态变为“禁用”，该账号登录时提示“账户已被禁用” |
| 管理员删除用户 | 1. 管理员页面删除`test_user`（先启用再删除）<br>2. 尝试用该账号登录                                    | 用户被移除；登录提示“无效的电子邮件或密码”      |

#### 3. 密码库核心功能测试

| 测试目标     | 测试步骤                                                                                                                                                                    | 预期结果                                   |
| -------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------- |
| 添加网站密码   | 1. 登录`test_user`<br>2. 点击“+”→“登录项”<br>3. 填写：<br>   - 名称：`测试银行`<br>   - 网址：`https://bank.example.com`<br>   - 用户名：`test_bank`<br>   - 密码：`Bank#2024$afePwd`<br>4. 点击“保存” | 密码项成功添加，在列表中可查看，点击可显示详情                |
| 编辑密码项    | 1. 打开“测试银行”条目<br>2. 修改密码为`NewBank@2024!`<br>3. 保存                                                                                                                       | 密码项更新成功，历史记录中可查看修改记录（点击“历史”）           |
| 密码生成器功能  | 1. 新建登录项时点击密码框右侧“生成”<br>2. 调整长度为16位，包含特殊字符<br>3. 应用生成的密码                                                                                                                | 生成符合规则的随机密码（如`xQ7$pL9!sR3@kT5%`），可直接使用 |
| 搜索密码项    | 1. 在搜索框输入“银行”<br>2. 输入不存在的关键词（如“无效”）                                                                                                                                    | 搜索“银行”显示“测试银行”条目；搜索“无效”显示“无结果”         |
| 删除与恢复密码项 | 1. 删除“测试银行”条目<br>2. 点击左侧“回收站”<br>3. 恢复该条目                                                                                                                               | 条目移至回收站；恢复后回到密码库主列表                    |

#### 4. 组织与共享测试

| 测试目标      | 测试步骤                                                               | 预期结果                                         |
| --------- | ------------------------------------------------------------------ | -------------------------------------------- |
| 创建组织（管理员） | 1. 管理员页面进入“组织管理”<br>2. 点击“新建组织”，名称：`测试团队`<br>3. 保存                 | 组织创建成功，显示在列表中                                |
| 邀请用户加入组织  | 1. 打开“测试团队”组织<br>2. 点击“邀请用户”，输入`share_user@example.com`<br>3. 发送邀请 | 邀请成功，普通用户登录时收到邀请通知                           |
| 接受组织邀请    | 1. 注册并登录`share_user@example.com`<br>2. 点击通知中的邀请链接<br>3. 接受邀请       | 成功加入“测试团队”，左侧菜单显示组织名称                        |
| 共享密码项到组织  | 1. `test_user`打开“测试银行”条目<br>2. 点击“共享”→选择“测试团队”<br>3. 确认共享          | `share_user`登录后可在“测试团队”中看到该密码项（只读或可编辑，取决于权限） |
| 撤销共享      | 1. `test_user`在共享设置中移除“测试团队”<br>2. `share_user`刷新页面                | `share_user`的组织中不再显示该密码项                     |

#### 5. 安全功能测试

| 测试目标       | 测试步骤                                                                                      | 预期结果                                    |
| ---------- | ----------------------------------------------------------------------------------------- | --------------------------------------- |
| 两因素认证（2FA） | 1. `test_user`进入“设置”→“安全”→“两因素认证”<br>2. 选择“TOTP”（如Google Authenticator）<br>3. 扫描二维码并输入验证码 | 2FA启用成功，下次登录需输入验证码                      |
| 主密码修改      | 1. 进入“设置”→“我的账户”→“更改主密码”<br>2. 旧密码：`VwTest@2024!`，新密码：`NewVw@2024$`<br>3. 保存              | 修改成功，下次登录需使用新密码                         |
| 数据导出（加密）   | 1. 进入“设置”→“数据导出”<br>2. 选择“加密JSON”，输入主密码<br>3. 导出文件                                        | 生成加密的`vaultwarden_export.json`，包含所有密码数据 |
| 数据导入验证     | 1. 新建测试用户`import_user@example.com`<br>2. 进入“数据导入”，上传导出的JSON文件<br>3. 输入加密密码                | 导入成功，所有密码项完整恢复                          |
| 自动锁定功能     | 1. 进入“设置”→“安全”，设置“自动锁定”为1分钟<br>2. 闲置1分钟后操作                                                | 系统自动锁定，需输入主密码解锁                         |

#### 6. 边缘场景与容错测试

| 测试目标       | 测试步骤                                                           | 预期结果                                 |
| ---------- | -------------------------------------------------------------- | ------------------------------------ |
| 重复账号处理     | 1. 尝试注册已存在的`test_user@example.com`<br>2. 保存相同用户名的密码项           | 注册提示“电子邮件已被使用”；密码项允许重名（但建议用户区分）      |
| 特殊字符兼容性    | 1. 添加密码包含emoji（如`Pwd😀2024!`）<br>2. 添加网址包含中文（如`https://测试.示例`） | 密码和网址正常保存，显示无乱码，复制后内容正确              |
| 离线访问验证     | 1. 断开网络连接<br>2. 访问已登录的Vaultwarden                              | 可查看已缓存的密码数据（符合本地存储特性）                |
| 容器重启后数据持久性 | 1. 执行`cd ~/vaultwarden && docker compose restart`<br>2. 登录查看数据 | 所有用户数据、密码项、设置均完整保留（数据存储在宿主机`data`目录） |

### 三、测试后清理（可选）

1. 删除测试用户：管理员页面移除`test_user`、`share_user`等测试账号
2. 清理测试数据：删除`~/vaultwarden/backups`中的测试备份（若启用了备份）
3. 重置管理员设置：如需重新测试，可删除`~/vaultwarden/.env`并重新运行部署脚本

### 测试用例设计原则

1. **覆盖核心场景**：聚焦Vaultwarden作为密码管理器的核心价值（存储、组织、共享、安全）
2. **可重复性**：所有步骤基于默认部署状态，无需额外配置即可执行
3. **安全性验证**：重点测试数据持久化、加密、权限控制等安全特性（符合运维对数据安全的核心诉求）
4. **贴近实际使用**：测试数据和操作流程模拟真实用户行为（如密码复杂度、多用户协作）

通过以上测试，可全面验证Vaultwarden部署后的功能完整性、数据安全性及稳定性，确保满足生产环境使用要求。
